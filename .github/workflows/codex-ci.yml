name: codex-ci
on:
  pull_request:
    types: [opened, synchronize, reopened]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - run: npm ci || true
      - run: npm test --if-present || echo "no tests"
  gi-gate:
    runs-on: ubuntu-latest
    needs: [test]
    steps:
      - uses: actions/checkout@v4
      - name: GI gate
        run: |
          echo "GI_BASELINE=${{ vars.KAIZEN_GI_BASELINE || 0.993 }}"
          # simple pass-through; replace with real GI check endpoint when ready
          if (( $(echo "${{ vars.KAIZEN_GI_BASELINE || 0.993 }} < 0.95" | bc -l) )); then
            echo "GI below threshold"; exit 1; fi
